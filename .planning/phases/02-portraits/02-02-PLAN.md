---
phase: 02-portraits
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/ui/alert-dialog.tsx
  - src/components/ui/dialog.tsx
  - src/components/ui/badge.tsx
  - src/components/ui/skeleton.tsx
  - src/components/portraits/portrait-card.tsx
  - src/components/portraits/portrait-grid.tsx
  - src/components/portraits/portrait-upload-dialog.tsx
  - src/components/portraits/delete-portrait-dialog.tsx
  - src/app/(dashboard)/portraits/page.tsx
  - src/app/(dashboard)/portraits/client.tsx
  - src/components/dashboard/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can view all portraits in a responsive grid"
    - "User can upload new portraits via dialog"
    - "User can set any portrait as active"
    - "User can delete portraits with confirmation"
    - "Active portrait shows visual indicator"
    - "Delete button disabled/hidden when only one portrait exists"
  artifacts:
    - path: "src/app/(dashboard)/portraits/page.tsx"
      provides: "Server component fetching portraits"
      min_lines: 20
    - path: "src/components/portraits/portrait-grid.tsx"
      provides: "Grid layout with portrait cards"
      min_lines: 30
    - path: "src/components/portraits/portrait-card.tsx"
      provides: "Individual portrait with actions"
      min_lines: 40
    - path: "src/components/portraits/portrait-upload-dialog.tsx"
      provides: "Upload dialog with drag-drop"
      min_lines: 50
  key_links:
    - from: "src/app/(dashboard)/portraits/page.tsx"
      to: "supabase.from('portraits').select()"
      via: "server-side fetch"
      pattern: "from\\(['\"]portraits['\"]\\)\\.select"
    - from: "src/components/portraits/portrait-grid.tsx"
      to: "src/actions/portraits.ts"
      via: "server action imports"
      pattern: "import.*from.*@/actions/portraits"
---

<objective>
Build the portraits page UI with grid layout, upload dialog, and card components for managing portrait library.

Purpose: Users can visually manage their portrait collection - view, upload, set active, and delete portraits.
Output: Complete /portraits page with interactive grid and dialogs.
</objective>

<execution_context>
@/Users/frutz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/frutz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-portraits/02-RESEARCH.md
@.planning/phases/02-portraits/02-01-SUMMARY.md

# Existing UI patterns
@src/components/onboarding/portrait-upload.tsx
@src/components/dashboard/sidebar.tsx
@src/app/(dashboard)/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add shadcn/ui components</name>
  <files>src/components/ui/alert-dialog.tsx, src/components/ui/dialog.tsx, src/components/ui/badge.tsx, src/components/ui/skeleton.tsx</files>
  <action>
Run shadcn CLI to add required components:

```bash
npx shadcn@latest add alert-dialog dialog badge skeleton
```

These components are needed for:
- AlertDialog: Delete confirmation
- Dialog: Upload modal
- Badge: "Active" indicator on portrait cards
- Skeleton: Loading state for portrait grid

Verify all four components are created in src/components/ui/.
  </action>
  <verify>All files exist: alert-dialog.tsx, dialog.tsx, badge.tsx, skeleton.tsx in src/components/ui/</verify>
  <done>shadcn/ui components installed and ready for use</done>
</task>

<task type="auto">
  <name>Task 2: Create portrait components and page</name>
  <files>
    src/components/portraits/portrait-card.tsx,
    src/components/portraits/portrait-grid.tsx,
    src/components/portraits/portrait-upload-dialog.tsx,
    src/components/portraits/delete-portrait-dialog.tsx,
    src/app/(dashboard)/portraits/page.tsx,
    src/app/(dashboard)/portraits/client.tsx
  </files>
  <action>
**Create directory:** src/components/portraits/

**1. portrait-card.tsx (Client Component)**
- Props: portrait object, onSetActive, onDelete, onEditLabel, isOnlyPortrait, isPending
- Display portrait image using next/image with aspect-square container
- Show "Active" Badge when portrait.is_active is true
- Hover overlay with action buttons:
  - "Set Active" button (hidden if already active)
  - "Delete" button (disabled if isOnlyPortrait)
- Show label below image (truncated)
- Use Card component from shadcn/ui

**2. portrait-grid.tsx (Client Component)**
- Props: portraits array (from server), userId
- Use useOptimistic for delete operations
- Use useTransition for isPending state
- Call server actions from @/actions/portraits
- Responsive grid: 2 cols on mobile, 3 on md, 4 on lg
- Map over portraits rendering PortraitCard
- Include PortraitUploadDialog at top
- Show DeletePortraitDialog when delete is triggered
- Handle toast notifications via sonner

**3. portrait-upload-dialog.tsx (Client Component)**
- Reuse upload logic from src/components/onboarding/portrait-upload.tsx
- Wrap in Dialog component (trigger: "Add Portrait" button with Plus icon)
- Add label input field (optional)
- On upload: call uploadPortrait server action, close dialog, show success toast
- Reset form state when dialog closes
- File validation: image/* only, max 5MB

**4. delete-portrait-dialog.tsx (Client Component)**
- AlertDialog with warning about permanent deletion
- Props: open, onOpenChange, onConfirm, portraitLabel
- Cancel and Delete buttons
- Delete button uses destructive variant

**5. portraits/page.tsx (Server Component)**
- Fetch user via supabase.auth.getUser()
- Redirect to /login if not authenticated
- Query portraits table: SELECT id, public_url, label, is_active, created_at
- Order by created_at DESC
- Pass portraits to client component

**6. portraits/client.tsx (Client Component)**
- Receive portraits and userId props
- Render page header with title and description
- Render PortraitGrid component

Follow existing component patterns:
- Use cn() from @/lib/utils for class merging
- Import icons from lucide-react (Star, Trash2, Plus, Loader2, Upload)
- Use sonner toast for notifications
  </action>
  <verify>Run `npx tsc --noEmit` - no TypeScript errors. Run `npm run dev` and navigate to /portraits (will need portraits table first)</verify>
  <done>All portrait components created with proper imports and typing</done>
</task>

<task type="auto">
  <name>Task 3: Enable portraits link in sidebar</name>
  <files>src/components/dashboard/sidebar.tsx</files>
  <action>
Update sidebar.tsx to enable the Portraits navigation link:

1. Find the navItems array
2. Locate the Portraits item (should have ImageIcon and href="/portraits")
3. Change disabled from true to false
4. Remove the "Soon" badge for Portraits

Keep other items (Generate, Gallery, Settings) disabled with "Soon" badge.

The sidebar should now show Portraits as a clickable link while other features remain "coming soon".
  </action>
  <verify>View sidebar in browser - Portraits link is clickable and navigates to /portraits</verify>
  <done>Portraits link enabled in dashboard sidebar</done>
</task>

</tasks>

<verification>
1. All shadcn/ui components installed
2. TypeScript compiles: `npx tsc --noEmit`
3. /portraits page renders with grid layout
4. Upload dialog opens and accepts images
5. Portrait cards show active state and action buttons
6. Sidebar Portraits link is enabled
</verification>

<success_criteria>
- [ ] User can view portraits in responsive grid (2/3/4 columns)
- [ ] User can upload new portrait via dialog with optional label
- [ ] Active portrait shows Badge indicator
- [ ] User can click "Set Active" on any portrait
- [ ] User can delete portrait with confirmation dialog
- [ ] Delete disabled when only one portrait exists
- [ ] Portraits sidebar link is enabled and navigable
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-portraits/02-02-SUMMARY.md`
</output>
